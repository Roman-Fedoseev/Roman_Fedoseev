# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Ü–µ–Ω–æ–≤—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ (p05‚Äìp95)  
## —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –º–µ—Ç—Ä–∏–∫–∏ IoU (Intersection over Union)

---

## –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å **—Ü–µ–Ω–æ–≤–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª** –¥–ª—è —Ç–æ–≤–∞—Ä–∞ ‚Äî **5-–π –∏ 95-–π –∫–≤–∞–Ω—Ç–∏–ª–∏ —Ü–µ–Ω—ã**, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—è –∫–∞—á–µ—Å—Ç–≤–æ **–Ω–µ –ø–æ MAE**, –∞ **–Ω–∞–ø—Ä—è–º—É—é –ø–æ –º–µ—Ç—Ä–∏–∫–µ IoU** –º–µ–∂–¥—É –∏—Å—Ç–∏–Ω–Ω—ã–º –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏.

---

## –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è —Ä–µ—à–µ–Ω–∏—è

–†–µ—à–µ–Ω–∏–µ —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ —Ç—Ä–µ—Ö —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö:

1. **–†–∞–∑–¥–µ–ª—å–Ω–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∏–∂–Ω–µ–π –∏ –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã**  
   - –æ—Ç–¥–µ–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è `p05`
   - –æ—Ç–¥–µ–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è `p95`

2. **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π feature engineering**, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ train-–¥–∞–Ω–Ω—ã—Ö**  
   (—Å—Ç—Ä–æ–≥–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç data leakage)

3. **–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ —à–∏—Ä–∏–Ω—ã –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞** –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏  
   —Å –ø—Ä—è–º–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π **IoU**, –≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∏–¥–µ—è–º–∏ *Conformal Prediction*

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è
Train \
‚îú‚îÄ‚îÄ Feature Engineering \
‚îÇ \
‚îú‚îÄ‚îÄ Model_low (p05) \
‚îÇ ‚îî‚îÄ‚îÄ Optuna ‚Üí best params \
‚îÇ \
‚îú‚îÄ‚îÄ Model_high (p95) \
‚îÇ ‚îî‚îÄ‚îÄ Optuna ‚Üí best params \
‚îÇ \
‚îú‚îÄ‚îÄ Calibration (validation) \
‚îÇ ‚îî‚îÄ‚îÄ Grid search –ø–æ (q_low, q_high) \
‚îÇ ‚îî‚îÄ‚îÄ max IoU \
‚îÇ \
‚îî‚îÄ‚îÄ Retrain on full train \
‚îî‚îÄ‚îÄ Apply calibrated intervals to test

---

## üß† Feature Engineering

–§–∏–Ω–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç **–∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –æ—Ç–±–æ—Ä–∞**.  
–Ø —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª —Ä–∞–∑–Ω—ã–µ –ø–æ–¥–Ω–∞–±–æ—Ä—ã —Ñ–∏—á–µ–π, —É–¥–∞–ª—è–ª —Å–ª–∞–±—ã–µ –∏ —à—É–º–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏,  
–∏ –≤ –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∏–ª —É—Å—Ç–æ–π—á–∏–≤—ã–π –Ω–∞–±–æ—Ä, –º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É—é—â–∏–π IoU.

–ü—Ä–∏–∑–Ω–∞–∫–∏:
- –ø–æ–≥–æ–¥–Ω—ã–µ
- —Å–µ–∑–æ–Ω–Ω—ã–µ
- –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ train
- –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–¥–ª—è CatBoost)

---

## –î–≤–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–æ–¥–µ–ª–∏
–ü–æ—á–µ–º—É —Ç–∞–∫:
- –∫–≤–∞–Ω—Ç–∏–ª–∏ –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã
- –Ω–∏–∂–Ω—è—è –∏ –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü—ã –∏–º–µ—é—Ç —Ä–∞–∑–Ω—É—é –¥–∏–Ω–∞–º–∏–∫—É
- –µ–¥–∏–Ω–∞—è –º–æ–¥–µ–ª—å —Ö—É–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —à–∏—Ä–∏–Ω—É –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞

–î–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–ª—Å—è Optuna —Å –ø–æ–¥–±–æ—Ä–æ–º:

- depth
- learning_rate
- l2_leaf_reg
- random_strength
- bagging_temperature
- min_data_in_leaf

---

## –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ (–∫–ª—é—á–µ–≤–∞—è —á–∞—Å—Ç—å)

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –∏—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.
–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ —à–∏—Ä–∏–Ω—ã –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞, –≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∏–¥–µ—è–º–∏
Conformal Prediction.

–ù–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –æ—à–∏–±–∫–∏:

nonconf_low  = pred_p05 - true_p05
nonconf_high = true_p95 - pred_p95

–û–Ω–∏ –æ—Ç—Ä–∞–∂–∞—é—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ –º–æ–¥–µ–ª—å –Ω–µ–¥–æ–æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã.

–î–≤–æ–π–Ω–æ–π –ø–µ—Ä–µ–±–æ—Ä –∫–≤–∞–Ω—Ç–∏–ª–µ–π

–ü–µ—Ä–µ–±–∏—Ä–∞—é—Ç—Å—è –ø–∞—Ä—ã (Œ±_low, Œ±_high):
alphas = np.linspace(0.1, 0.9, 81)

–î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è:
q_low  = quantile(nonconf_low,  1 - Œ±_low  / 2)
q_high = quantile(nonconf_high, 1 - Œ±_high / 2)


–§–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –æ—Ç–∫–∞–ª–∏–±—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã:
p05 = pred_p05 - q_low
p95 = pred_p95 + q_high

–î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã —Å—á–∏—Ç–∞–µ—Ç—Å—è:
IoU = |intersection(true_interval, predicted_interval)|
      / |union(true_interval, predicted_interval)|

–í—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–∞—Ä–∞ (q_low, q_high), –º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É—é—â–∞—è IoU.

---

## –§–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –ø–æ–¥–±–æ—Ä–∞ –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤:
- —á–∏—Å–ª–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –±–µ—Ä–µ—Ç—Å—è –∏–∑ best_iteration \
- –º–æ–¥–µ–ª–∏ –ø–µ—Ä–µ–æ–±—É—á–∞—é—Ç—Å—è –Ω–∞ –≤—Å–µ–º train \
- –Ω–∞–π–¥–µ–Ω–Ω—ã–µ q_low, q_high –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ test

---
